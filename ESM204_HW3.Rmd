---
title: "ESM 204 HW 3"
author: "Sarah Lam and Alissa Patterson"
date: "5/5/2022"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse) 
library(here)
library(rootSolve)
library(janitor)
library(equatiomatic)
```

```{r}
### Sandy's code
electric_demand <- read_csv(here("HW3_data.csv")) %>% 
  select(-1) %>% 
  clean_names()

# running linear models to get demand curves for high and low income consumers
model_demand_low <- lm(price_cents  ~ q_low_kwh, data = electric_demand) #P = 23.37097 -.00011Q
model_demand_high <- lm(price_cents ~ q_high_kwh, data = electric_demand) #P = 31.606856 -.000052Q

# Qgg = Qlow(P) + Qlow(h) 
```

```{r}
#FUNCTIONS
# define a function to get demand
demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  q <- ifelse(q<0,0,q) #y-intercepts differ, Qagg(P) will have a kink include ifelse() statement to take care of kink
  return(q)
}

# for each p level, return estimated aggregate demand
demand_agg <- function(p){
  q <- demand(p, model_demand_low) + demand(p, model_demand_high)
  return(q)
}

#define functions for calculating the consumer surplus:
CS <- function(p, model){
  q <- demand(p, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

CS_agg <- function(p){
  cs <- CS(p,model_demand_l) + CS(p,model_demand_h)
  return(cs)
}
```

Last year, the Biden Administration assembled an Inter-agency Working Group (IWG) tasked with
updating the United States Government’s Social Cost of Carbon (SCC), which has not been comprehensively updated since 2010. The Administration has also called on government agencies to
address environmental justice, racism, and equity concerns when considering policies designed to
mitigate climate change.
While the Interagency Working Group develops a new SCC, the Biden Administration’s “interim”
value is $51 per metric ton of CO2. The electricity sector is the second largest source of greenhouse
gas emissions in the U.S. (after transportation). In this homework, you will consider the distributional consequences of imposing a household electricity tax based on the SCC to address the climate
change problem.
We recommend using R and writing functions to compute your answers wherever possible.
Use the following set of facts:
• Consumers can be separated into two income groups: “high” and “low.” The data set provides
price (in $) and quantity (in kWh) estimates of demand per month for the two groups. Run
linear regressions (with an intercept) to estimate the demand curves for “high” and “low”
income consumers.
• Initially, there is no tax on electricity consumption.
• The current electricity price (without any taxes) is $.10 per kWh.
• The marginal cost of producing a kWh of electricity is linear and has a price-intercept of 0.

1. One kWh of electricity emits 0.85 pounds of CO2. Assuming that the interim SCC correctly
reflects the total social cost of one metric ton of CO2, what is the marginal externality cost
per kwH of electricity?

```{r}
#define variables
metric_ton <- 2204.62
scc_co2 <- 51
cents_per_kwh <- (0.85/metric_ton)*100*scc_co2
```

Marginal externality cost per kWh of electricity: 
emissions in metric tons * social cost of carbon * 100 (to convert to cents) 

= **1.97 cents**

2. What is the aggregate monthly demand curve for electricity? What is the supply curve for
electricity? What is the “benefit” to consumers under the status quo? What is the “benefit”
to producers under the status quo? What is the environmental cost under the status quo?

Low income demand curve: 

```{r}
# dataframe monthly demand curve for electricity
e_d_long <- electric_demand %>% 
  pivot_longer(cols = c(q_low_kwh, q_high_kwh),
               names_to = 'income_level',
               values_to = 'kwh') %>% 
  mutate(income_level = case_when(income_level == 'q_low_kwh' ~ 'low',
                   income_level == 'q_high_kwh' ~ 'high'))

# Low income demand curve
demand_low <- lm(price_cents ~ kwh, income_level=='low', 
                 data = e_d_long) 
extract_eq(model = demand_low, use_coefs = TRUE, coef_digits = 5)
```

High income demand curve:

```{r}
demand_high <- lm(price_cents ~ kwh, income_level=='high',
                  data = e_d_long) 
extract_eq(model = demand_high, use_coefs = TRUE, coef_digits = 5)
```

Aggregate demand curve: 

```{r}
# demand model function
demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}

# function for aggregating demand curve
demand_agg <- function(p){
  q <- demand(p, demand_low) + demand(p, demand_high)
  return(q)
}

# sum horizontally to get the aggregate demand curve:
# Make a vector and extract the lm 
price = seq(0, 30, length.out = 100)
Qagg <- map(price, demand_agg) %>% 
  unlist()
agg_df<- tibble(Qagg = Qagg, price = price)
demand_agg_eq <- lm(price ~ Qagg, data = agg_df) 
extract_eq(model = demand_agg_eq, use_coefs = TRUE, coef_digits = 5)

agg_slope <- demand_agg_eq$coefficients[2]
agg_int <- demand_agg_eq$coefficients[1]
```

Supply curve for electricity: 

```{r}
#supply curve for electricity 
kwh_agg <- demand_agg(10)
#536,719.5 kWh consumed @ $0.10
supply_slope <- 10/kwh_agg
```

**P = 0.0000186Q** (note: price in cents not $)

```{r}
# “benefit” to consumers under the status quo. CS needs Y intercept --> at 0 kWh, price would be $0.305
# Note the conversion back to dollars 
cs_baseline <- 0.5*kwh_agg*(0.305 - 0.10)
# $55,013.74
```


```{r}
# “benefit” to producers under the status quo
ps_baseline <- 0.5*kwh_agg*0.10
# $26,835.97
```


```{r}
# environmental cost under the status quo
# cost is rectangle 
env_cost_baseline <- cents_per_kwh*kwh_agg
# $1,055,365.05
```

- `r round(cs_baseline, 2)`
- Consumer Benefit = $`r round(cs_baseline, 2)`
- Producer Benefit = $`r round(ps_baseline, 2)`
- Environmental Cost = $`r round(env_cost_baseline, 2)`

3. How is the current consumer benefit divided between “high” and “low” income consumers?

```{r}
# finding the consumer surplus for each income group
cs_low <- CS(10, model_demand_low)
cs_high <- CS(10, model_demand_high)
```

**Consumer benefit for high income consumers:** $`r round(cs_high/100, 2)`

**Consumer benefit for low income consumers:** $`r round(cs_low/100, 2)`

The low income consumers have a lower consumer benefit than the high income by a difference of $`r round((cs_high-cs_low)/100, 2)`

4. Derive the optimal electricity tax (in cents per kWh) using the interim SCC. 
Based on the interim SCC the optimal electricity tax is *1.97* cents/kWh
Noting that recent research has shown the poor face a disproportionate share of the impacts from climate change,
assume that the climate externality is borne entirely by the “low” income group. What would
be the effects of this tax on:
(a) This tax decreases the amount of electricity produced and consumed.
(b) The price of electricity increases by the amount of the tax, 1.97 cents/kWh.
(c) The verall welfare of “high” income consumers under the tax scenario is described by the consumer surplus of $`r round(cs_tax_high, 2)`.
(d) The overall welfare of “low” income consumers under the tax scenario is described by the consumer surplus of $`r round(cs_tax_low)`.
(e) The surplus to the producers of electricity under the tax scenario is $`r round(ps_tax, 2)`.
(f) The total environmental damage under the tax scenario is $`r round(env_cost_tax, 2)`.
(g) The total tax revenue generated under the tax scenario is $`r round(env_cost_tax, 2)`.

```{r}
# supply curve adjusted for tax 
#P = 0.0000186Q + 1.97

#high and low income surplus = welfare
cs_tax_high <- CS(.1197, model_demand_high)/100
#9529852.41
cs_tax_low <- CS(.1197, model_demand_low)/100
#2453119.07

#ps under tax 
ps_tax <- 0.5*demand_agg(11.97)*0.1197 - env_cost_tax
#18194.63

env_cost_tax <- 1.97*537634.409/100
#10591.4
```

5. Now, assume that all revenue from the electricity tax will be redistributed to the consumers in
proportion to their pre-tax consumption. For example, if 80% of the electricity was consumed
by “high” income consumers, then they get 80% of the tax revenue. Additionally, consider the
fact that current scientific evidence suggests the true SCC may be much higher than $51. For
a range of SCC values ($51, $75, $100, $125, and $150 per metric ton of CO2), calculate the
effects of an SCC-based electricity tax on:
(a) Overall welfare of “high” income consumers
(b) Overall welfare of “low” income consumers
(c) Electricity producers

6. Suppose the “high” income group has access to expensive home solar generation. This lowers
the electricity demand curve for the “high” income group by half (vertically). Under this new
demand:
(a) What is total electricity consumption?
(b) What is the total environmental externality?
(c) What value of the electricity tax makes the total environmental damage the same as the
damage when solar panels are available to the high income group?

